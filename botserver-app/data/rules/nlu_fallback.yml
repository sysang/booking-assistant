version: "3.1"

rules:
- rule: Ask the user to rephrase whenever they send a message with low NLU confidence, idle
  condition:
    - slot_was_set:
      - botmind_state: attentive
      - botmind_context: idle
      - botmemo_booking_progress: null
  steps:
  - intent: nlu_fallback
  - action: utter_please_rephrase

- rule: Ask the user to rephrase whenever they send a message with low NLU confidence, workingonbooking
  condition:
    - slot_was_set:
      - botmind_state: attentive
      - botmind_context: workingonbooking
      - botmemo_booking_progress: null
  steps:
  - intent: nlu_fallback
  - action: utter_please_rephrase

- rule: Ask the user to rephrase whenever they send a message with low NLU confidence, workingonbooking, bkinfo_form, initialized
  condition:
  - slot_was_set:
    - botmind_state: attentive
    - botmind_context: workingonbooking
    - botmemo_booking_progress: initialized
  - active_loop: bkinfo_form
  steps:
  - intent: nlu_fallback
  - action: action_execution_rejected
  - action: action_deactivate_loop
  - active_loop: null
  - action: utter_please_rephrase
  - action: bkinfo_form
  - active_loop: bkinfo_form
  wait_for_user_input: false

- rule: Ask the user to rephrase whenever they send a message with low NLU confidence, workingonbooking, bkinfo_form, information_collecting
  condition:
  - slot_was_set:
    - botmind_state: attentive
    - botmind_context: workingonbooking
    - botmemo_booking_progress: information_collecting
  - active_loop: bkinfo_form
  steps:
  - intent: nlu_fallback
  - action: action_execution_rejected
  - action: action_deactivate_loop
  - active_loop: null
  - action: utter_please_rephrase
  - action: bkinfo_form
  - active_loop: bkinfo_form
  wait_for_user_input: false
